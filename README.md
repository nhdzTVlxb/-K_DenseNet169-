# -K_DenseNet169-
2024‘未来杯’A题做法交流，数据集是南京大学给出的岩矿石薄片图片。

## 一、项目背景
在地质学和矿物学领域，岩矿石薄片广泛应用于岩石分类、岩石演化、岩石地球化学以及矿物学等领域，对于矿产勘探和开发具有重要意义。
通过镜下岩矿石薄片，可以识别矿石中所含金属矿物，进而深入了解矿石的特征。
然而，岩矿石薄片的准确识别和分类一直是具有挑战性的任务。人工鉴定工作通过偏光显微镜进行，存在主观性强、成本高以及效率低下等问题。

## 二、问题一：沉积岩薄片识别任务
请参赛队伍使用“南京大学岩石教学薄片显微图像数据集”中的“南京大学沉积岩教学薄片照片数据集”，结合颜色、纹理、亮度等多种特征，
设计一个沉积岩薄片识别模型，实现对该数据集中火山碎屑岩、砂岩、泥页岩、粉砂岩、灰岩、白云岩、硅质岩、蒸发岩和其他岩石的识别功能。
（数据集链接可能侵权，读者需要请自行寻找）

## 三、方案选择与文献基础
我们有尝试enet（网上获取预训练权重），resenet 50等一些轻量化模型。
前者训练十分不稳定，但是效果也达到了90-99%，epoch为10，loss降的很快，但是每次结果都不稳定。后者因为数据集太少（700）而过拟合。
我在阅读文献的时候发现了来自Applied Computing and Geosciences Volume 23, September 2024, 100192的Advancing geological image segmentation: Deep learning approaches for rock type identification and classification一文
同样他们也是处理岩石切片类数据集，拥有900张数据集，本文作者即是在此基础上完成复现，做出修改。

## 四、数据处理方法
见data—_to_four.py 将原数据集一分为四，扩展数据集。
将切割好的数据集，按照70%，15%，15%的比例分为train，test，val数据集，详细见data_distribution.py

## 五、训练策略与模型评价
作者是用了交叉验证法，在小数据集上，这确实是个不错的选择；
在原作上，我复现代码时，发现测试集的效果过于好了，甚至5个fold里面训练出两个测试集100%精度，我们希望精度好的同时，并不希望看到这样的果，我们可能无法判断它是不是真的那么优秀，于是我在原文基础上加了很强的数据增强，结果更加稳定，切拟合度更高，达到了99.68%的精度，30个epoch就足够了DenseNet169_train.py。
评价的方式见test.py，并给出了每个Fold的loss，acc训练曲线，以及分类的混淆矩阵。

## 六、问题二与问题三的解决方案
### 问题二：模型改进与特征融合
请验证问题一中所建立的模型是否能够有效识别这三种不同类别的岩石。近年来，深度学习方法在数字图像处理领域展现出显著优势，能够有效提取图像中的丰富特征，在岩石识别应用方面也取得较大进展。是否能将颜色、纹理等特征与深度学习特征进行有效的结合，进一步提升分类模型的准确率呢？请在问题一的研究基础上，对模型进行改进，重新对变质岩、沉积岩和火成岩这三种岩石进行分类识别。
我们对问题 1 建立的 DenseNet169模型在数据集上进行训练得出实验结果，然后在 DenseNet 模型基础上结合纹理特征进行改进，提出了 Texture-DenseNet 模型。创新设计了纹理注意力机制（TextureAttention）模块，在每个 Dense Block 后应用纹理注意力机制，增强模型对纹理信息的捕捉能力。见Texture-DenseNet.py原有的DenseNet169，在三类数据集上达到了98.69%的准确率，切每个Fold训练结果更稳定，更加拟合。修改后的Texture-DenseNet在此基础上精度又提高了0.5个点左右，能达到99.2%左右。

### 问题三：预测与集成策略
问题三是用权重进行一个预测，本文给出基于训练出的五个权重的投票机制预测，减少误差。（仅供参考）
